
@{
    ViewData["Title"] = "Chart of Accounts";
}

<h2 class="title-text">@ViewData["Title"]</h2>
@*<div class="ui pointing secondary menu" id="glacc-table">
        <a class="item active" data-tab="GetAcc?acc_group=1" id="Assets">Assets</a>
        <a class="item" data-tab="GetAcc?acc_group=2" id="Liabilities">Liabilities</a>
        <a class="item" data-tab="GetAcc?acc_group=3" id="Equity">Shareholder's Equity</a>
        <a class="item" data-tab="GetAcc?acc_group=4" id="Income">Income</a>
        <a class="item" data-tab="GetAcc?acc_group=5" id="Expense">Expenses</a>
    </div>
    <div class="ui tab segment active active" data-tab="GetAcc?acc_group=1">
        First
    </div>
    <div class="ui tab segment" data-tab="GetAcc?acc_group=2">
        Second
    </div>
    <div class="ui tab segment" data-tab="GetAcc?acc_group=3">
        Third
    </div>
    <div class="ui tab segment" data-tab="GetAcc?acc_group=4">
        Fourth
    </div>
    <div class="ui tab segment" data-tab="GetAcc?acc_group=5">
        Fifth
    </div>


    @section Scripts{
        <script>
            $(document).ready(function () {
                $("#Assets").click();
            })
        </script>
    }*@
<div class="ui inverted menu">
    <a class="item" onclick="$(this).addForm()" id="btn-add">
        <i class="add icon green"></i>
        Add
    </a>
    <a class="item" onclick="$(this).editForm()" id="btn-edit">
        <i class="edit icon yellow"></i>
        Edit
    </a>
    <a class="item" onclick="$(this).deleteConfirm()" id="btn-delete">
        <i class="delete icon red"></i>
        Delete
    </a>
</div>
<div class="ui two column stackable grid">
    <div class="ten wide column" id="glacc-chart-panel">
        <div class="scrollable-box-wrapper">
            <div class="scrollable-box">
                <div class="layer" id="readonly-layer" style="display: none;"></div>
                <p style="padding: 10px 10px 5px; margin-bottom: 0;">Chart of Accounts</p>
                <div id="glacc-chart">
                    @foreach (var acc1 in (List<GlaccVM>)Model)
                    {
                        <ul class="jstree-container-ul jstree-children" role="group">
                            <li role="treeitem" aria-selected="false" aria-level="1" aria-labelledby="j4_1_anchor" aria-expanded="true" id="@acc1.accgrp-j4_1_@acc1.Glacc.id" class="jstree-node  jstree-closed" aria-id="@acc1.Glacc.id">
                                <i class="jstree-icon jstree-ocl" role="presentation"></i>
                                <a class="jstree-anchor" href="#" tabindex="-1" id="@acc1.accgrp-j4_1_@(acc1.Glacc.id)_anchor">
                                    <i class="jstree-icon jstree-themeicon" role="presentation"></i>@acc1.accnum @acc1.accnam
                                </a>
                                @if (acc1.childacc.Count > 0)
                                {
                                    <ul role="group" class="jstree-children" style="">
                                        @foreach (var acc2 in (List<GlaccVM>)acc1.childacc)
                                        {
                                            <li role="treeitem" aria-selected="false" aria-level="2" aria-labelledby="j4_2_anchor" id="@acc2.accgrp-j4_2_@acc2.Glacc.id" class="jstree-node jstree-closed" aria-id="@acc2.Glacc.id">
                                                <i class="jstree-icon jstree-ocl" role="presentation"></i>
                                                <a class="jstree-anchor" href="#" tabindex="-1" id="@acc2.accgrp-j4_2_@(acc2.Glacc.id)_anchor">
                                                    <i class="jstree-icon jstree-themeicon" role="presentation"></i>@acc2.accnum @acc2.accnam
                                                </a>
                                                @if (acc2.childacc.Count > 0)
                                                {
                                                    <ul role="group" class="jstree-children" style="">
                                                        @foreach (var acc3 in (List<GlaccVM>)acc2.childacc)
                                                        {
                                                            <li role="treeitem" aria-selected="false" aria-level="3" aria-labelledby="j4_3_anchor" id="@acc3.accgrp-j4_3_@acc3.Glacc.id" class="jstree-node jstree-closed" aria-id="@acc3.Glacc.id">
                                                                <i class="jstree-icon jstree-ocl" role="presentation"></i>
                                                                <a class="jstree-anchor" href="#" tabindex="-1" id="@acc3.accgrp-j4_3_@(acc3.Glacc.id)_anchor">
                                                                    <i class="jstree-icon jstree-themeicon" role="presentation"></i>@acc3.accnum @acc3.accnam
                                                                </a>
                                                                @if (acc3.childacc.Count > 0)
                                                                {
                                                                    <ul role="group" class="jstree-children" style="">
                                                                        @foreach (var acc4 in (List<GlaccVM>)acc3.childacc)
                                                                        {
                                                                            <li role="treeitem" aria-selected="false" aria-level="4" aria-labelledby="j4_4_anchor" id="@acc4.accgrp-j4_4_@acc4.Glacc.id" class="jstree-node jstree-leaf jstree-last" aria-id="@acc4.Glacc.id">
                                                                                <i class="jstree-icon jstree-ocl" role="presentation"></i>
                                                                                <a class="jstree-anchor" href="#" tabindex="-1" id="@acc4.accgrp-j4_4_@(acc4.Glacc.id)_anchor">
                                                                                    <i class="jstree-icon jstree-file" role="presentation"></i>**@acc4.accnum @acc4.accnam
                                                                                </a>
                                                                            </li>


                                                                        }
                                                                    </ul>
                                                                }
                                                            </li>
                                                        }
                                                    </ul>
                                                }
                                            </li>
                                        }
                                    </ul>
                                }
                            </li>
                        </ul>
                    }
                </div>
            </div>
        </div>


    </div>
    <div class="six wide column" id="glacc-form-panel">
        <form class="ui form" method="post" asp-controller="Glacc" asp-action="AddEdit" onsubmit="" id="glacc-form">
            <h4 class="ui dividing header">Add/Edit Account</h4>
            <input type="hidden" name="glacc[id]" value="-1" />
            <div class="field">
                <label>Account Number</label>
                <div class="eight wide field">
                    <input type="text" name="glacc[accnum]" placeholder="Account Number" disabled="disabled" />
                </div>
            </div>
            <div class="field">
                <label>Account Name</label>
                <div class="sixteen wide field">
                    <input type="text" name="glacc[accnam]" placeholder="Account Name (Th.)" disabled="disabled" />
                </div>
                <div class="sixteen wide field">
                    <input type="text" name="glacc[accnam2]" placeholder="Account Name (En.)" disabled="disabled" />
                </div>
            </div>
            <div class="field">
                <div class="fields">
                    <div class="thirteen wide field">
                        <label>Parent Account</label>
                        <div class="field">
                            @*<select class="ui fluid dropdown" name="glacc[parent]">
                                <option value=""></option>
                                <option value="AL">Alabama</option>
                                <option value="AK">Alaska</option>
                            </select>*@
                            <input type="text" name="glacc[parent]" placeholder="Parent Account" disabled="disabled" />
                        </div>
                    </div>
                    <div class="three wide field">
                        <label>Level</label>
                        <div class="field">
                            <input type="text" name="glacc[level]" disabled="disabled" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="field">
                <div class="fields">
                    <div class="eight wide field">
                        <label>Group</label>
                        <div class="field">
                            <select class="ui fluid dropdown" name="glacc[group]" disabled="disabled">
                                <option value="1">1 - Assets</option>
                                <option value="2">2 - Liability</option>
                                <option value="3">3 - Equity</option>
                                <option value="4">4 - Revenue</option>
                                <option value="5">5 - Expense</option>
                            </select>
                        </div>
                    </div>
                    <div class="eight wide field">
                        <label>Type</label>
                        <div class="field">
                            <select class="ui fluid dropdown" name="glacc[acctyp]" disabled="disabled">
                                <option value="0">0 - Posting</option>
                                <option value="1">1 - Summary</option>
                            </select>
                        </div>
                    </div>
                </div>

            </div>
            <div class="field">
                <div class="fields">
                    <div class="eight wide field">
                        <label>Use Dept.</label>
                        <div class="field">
                            <select class="ui fluid dropdown" name="glacc[usedep]" disabled="disabled">
                                <option value="N">N - No</option>
                                <option value="Y">Y - Yes</option>
                                <option value="M">M - Must specify dept.</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <button type="submit" class="ui button green" tabindex="0" disabled="disabled" id="btn-submit"><i class="check circle icon"></i>Submit</button>
            <button type="button" class="ui button grey" tabindex="1" onclick="$(this).clearForm()" disabled="disabled" id="btn-cancel"><i class="times circle icon"></i>Cancel</button>
        </form>
    </div>
</div>

@section Scripts{
    <script>
        var form_state = 'R';
        $(document).ready(function () {
            $('#glacc-chart').jstree({
                //"core": {
                //    "animation": 0,
                //    "check_callback": true,
                //    "themes": { "stripes": true },
                //    'data': {
                //        'url': function (node) {
                //            return node.id === '#' ?
                //                'ajax_demo_roots.json' : 'ajax_demo_children.json';
                //        },
                //        'data': function (node) {
                //            return { 'id': node.id };
                //        }
                //    }
                //},
                //"types": {
                //    "#": {
                //        "max_children": 1,
                //        "max_depth": 4,
                //        "valid_children": ["root"]
                //    },
                //    "root": {
                //        "icon": "/static/3.3.5/assets/images/tree_icon.png",
                //        "valid_children": ["default"]
                //    },
                //    "default": {
                //        "valid_children": ["default", "file"]
                //    },
                //    "file": {
                //        "icon": "glyphicon glyphicon-file",
                //        "valid_children": []
                //    }
                //},
                //"plugins": [
                //    "contextmenu", "dnd", "search",
                //    "state", "types", "wholerow"
                //]
            });

            $('#glacc-chart').on('changed.jstree', function (e, data) {
                var id = $('#' + data.selected).attr('aria-id');
                $.ajax({
                    type: "GET",
                    url: "/Glacc/GetAcc",
                    data: { id: id },
                    contentType: "application/json; charset=utf-8",
                    dataType: 'json'
                }).done(function (acc) {
                    $('#glacc-form [name="glacc[id]"]').val(acc.id);
                    $('#glacc-form [name="glacc[accnum]"]').val(acc.accnum);
                    $('#glacc-form [name="glacc[accnam]"]').val(acc.accnam);
                    $('#glacc-form [name="glacc[accnam2]"]').val(acc.accnam2);
                    $('#glacc-form [name="glacc[parent]"]').val(acc.parent);
                    $('#glacc-form [name="glacc[level]"]').val(acc.level);
                    $('#glacc-form [name="glacc[group]"]').val(acc.group);
                    $('#glacc-form [name="glacc[acctyp]"]').val(acc.acctyp);
                    $('#glacc-form [name="glacc[usedep]"]').val(acc.usedep);
                });

            });
        });


        $(".ui.sticky").sticky({
            context: '#example1'

        });

        $.fn.extend({
            addForm: function () {
                if (form_state !== 'R')
                    return;

                $('#readonly-layer').fadeIn(100);
                $('#glacc-form [name="glacc[id]"]').val("-1");
                $('#glacc-form [name="glacc[accnum]"]').removeAttr('disabled').focus();
                $('#glacc-form [name="glacc[accnam]"]').removeAttr('disabled');
                $('#glacc-form [name="glacc[accnam2]"]').removeAttr('disabled');
                $('#glacc-form [name="glacc[parent]"]').removeAttr('disabled');
                $('#glacc-form [name="glacc[group]"]').removeAttr('disabled');
                $('#glacc-form [name="glacc[acctyp]"]').removeAttr('disabled');
                $('#glacc-form [name="glacc[usedep]"]').removeAttr('disabled');
                $('#glacc-form #btn-submit').removeAttr('disabled');
                $('#glacc-form #btn-cancel').removeAttr('disabled');
                form_state = 'A'
                console.log(form_state);
            },

            editForm: function () {
                if (form_state !== 'R' || $('#glacc-form [name="glacc[accnum]"]').val().trim().length == 0)
                    return;

                $('#readonly-layer').fadeIn(100);
                $('#glacc-form [name="glacc[accnam]"]').removeAttr('disabled').focus();
                $('#glacc-form [name="glacc[accnam2]"]').removeAttr('disabled');
                $('#glacc-form [name="glacc[parent]"]').removeAttr('disabled');
                $('#glacc-form [name="glacc[group]"]').removeAttr('disabled');
                $('#glacc-form [name="glacc[acctyp]"]').removeAttr('disabled');
                $('#glacc-form [name="glacc[usedep]"]').removeAttr('disabled');
                $('#glacc-form #btn-submit').removeAttr('disabled');
                $('#glacc-form #btn-cancel').removeAttr('disabled');
                form_state = 'E'
                console.log(form_state);
            },

            clearForm: function () {
                $('#readonly-layer').fadeOut(100);
                $('#glacc-form [name="glacc[accnum]"]').attr({ 'disabled': 'disabled' });
                $('#glacc-form [name="glacc[accnam]"]').attr({ 'disabled': 'disabled' });
                $('#glacc-form [name="glacc[accnam2]"]').attr({ 'disabled': 'disabled' });
                $('#glacc-form [name="glacc[parent]"]').attr({ 'disabled': 'disabled' });
                $('#glacc-form [name="glacc[group]"]').attr({ 'disabled': 'disabled' });
                $('#glacc-form [name="glacc[acctyp]"]').attr({ 'disabled': 'disabled' });
                $('#glacc-form [name="glacc[usedep]"]').attr({ 'disabled': 'disabled' });
                $('#glacc-form #btn-submit').attr({ 'disabled': 'disabled' });
                $('#glacc-form #btn-cancel').attr({ 'disabled': 'disabled' });
                form_state = 'R'
                console.log(form_state);
            },

        });
    </script>
}